# Azure VPN Server module

Module to provision vpn-server on azure


## Software dependencies

The module depends on the following software components:

### Terraform version

- \>= v0.15

### Terraform providers


- azurerm (hashicorp/azurerm)

### Module dependencies


- resource_group - [github.com/cloud-native-toolkit/terraform-azure-resource-group](https://github.com/cloud-native-toolkit/terraform-azure-resource-group) (>= 1.1.1)
- vnet - [github.com/cloud-native-toolkit/terraform-azure-vnet](https://github.com/cloud-native-toolkit/terraform-azure-vnet) (>= 1.1.3)
- subnet - [github.com/cloud-native-toolkit/terraform-azure-subnets](https://github.com/cloud-native-toolkit/terraform-azure-subnets) (>= 1.3.8)
- ssh_key - [github.com/cloud-native-toolkit/terraform-azure-ssh-key](https://github.com/cloud-native-toolkit/terraform-azure-ssh-key) (>= 1.0.6)

## Example usage

```hcl
module "vpn-server" {
  source = "github.com/cloud-native-toolkit/terraform-azure-vpn-server"

  admin_username = var.vpn-server_admin_username
  bootstrap_script = var.vpn-server_bootstrap_script
  client_network = var.vpn-server_client_network
  client_network_bits = var.vpn-server_client_network_bits
  name_prefix = var.vpn-server_name_prefix
  private_dns = var.vpn-server_private_dns == null ? null : jsondecode(var.vpn-server_private_dns)
  private_ip_address_allocation_type = var.vpn-server_private_ip_address_allocation_type
  private_key_file = module.ssh-keys.private_key_file
  private_network_cidrs = var.vpn-server_private_network_cidrs == null ? null : jsondecode(var.vpn-server_private_network_cidrs)
  pub_ssh_key_file = module.ssh-keys.pub_key_file
  resource_group_name = module.resource_group.name
  storage_type = var.vpn-server_storage_type
  subnet_id = module.ingress_subnet.id
  virtual_network_name = module.vnet.name
  vm_public_ip_allocation_method = var.vpn-server_vm_public_ip_allocation_method
  vm_public_ip_sku = var.vpn-server_vm_public_ip_sku
  vm_size = var.vpn-server_vm_size
}

```

## Module details

### Inputs

| Name | Description | Required | Default | Source |
|------|-------------|---------|----------|--------|
| resource_group_name | The name of the Azure resource group where the VM is to be provisioned. The VM will be provisioned in the same location as the resource group. | true |  | resource_group.name |
| virtual_network_name | The name of the Azure VNet. | true |  | vnet.name |
| subnet_id | The Azure subnet id to which to attach the virtual machine private NIC | true |  | subnet.id |
| pub_ssh_key_file | Path to the public SSH key for VM access. | true |  | ssh_key.pub_key_file |
| private_key_file | Path to the SSH private key for remote access. | true |  | ssh_key.private_key_file |
| private_network_cidrs | List of CIDRs in the private network reachable via the VPN server. | true |  |  |
| private_dns | List of private DNS servers | false | 168.63.129.16 |  |
| name_prefix | Name to prefix resources created | false | open-vpn |  |
| client_network | Network address for VPN clients (default = \"172.27.224.0\") | false | 172.27.224.0 |  |
| client_network_bits | Number of netmask bits for the VPN client network (default = \"24\") | false | 24 |  |
| private_ip_address_allocation_type | The Azure subnet private ip address alocation type - Dynamic or Static (default = \"Dynamic\") | false | Dynamic |  |
| admin_username | Username for the admin user (default = \"adminuser\") | false | azureuser |  |
| bootstrap_script | Path to file with the bootstrap script (default = \"./template/user-data.sh\") | true |  |  |
| vm_size | This is the size of Virtual Machine (defualt = \"Standard_F2\") | false | Standard_B1s |  |
| storage_type | Storage account type (default = \"StandardSSD_LRS\") | false | StandardSSD_LRS |  |
| vm_public_ip_sku | Public IP SKU Size (default = \"Standard\") | false | Standard |  |
| vm_public_ip_allocation_method | The Azure subnet Public ip address alocation type - Dynamic or Static (default = \"Dynamic\") | false | Static |  |

### Outputs

| Name | Description |
|------|-------------|
| id | The Azure id of the created VPN server |
| vm_public_ip | The public IP address of the created VPN server |
| vm_public_fqdn | The FQDN of the public IP address |
| admin_username | The administrator username of the created VPN server |
| vm_private_ip | The private IP address of the created VPN server |
| client_config_file | The full path and filename of the created VPN client connection file |

## Resources

- [Documentation](https://operate.cloudnativetoolkit.dev)
- [Module catalog](https://modules.cloudnativetoolkit.dev)

> License: Apache License 2.0 | Generated by iascable (0.1.8)
